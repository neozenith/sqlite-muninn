"""KG pipeline chart definitions (extraction, RE, ER, GraphRAG)."""

from benchmarks.harness.analysis.aggregator import ChartSpec

KG_CHARTS = [
    # ── Existing extraction charts (Gutenberg-sourced) ────────────
    ChartSpec(
        name="kg_extraction_speed",
        title="NER Extraction Speed by Model",
        sources=["kg-extract_*.jsonl"],
        filters={},
        x_field="model_slug",
        y_field="avg_ms_per_chunk",
        group_fields=["model_slug"],
        variant_fields=[],
        repeat_fields=["model_slug", "data_source"],
        y_label="Avg ms/chunk",
        x_label="NER Model",
    ),
    ChartSpec(
        name="kg_extraction_entity_count",
        title="Entity Count by Model",
        sources=["kg-extract_*.jsonl"],
        filters={},
        x_field="model_slug",
        y_field="n_entities",
        group_fields=["model_slug"],
        variant_fields=[],
        repeat_fields=["model_slug", "data_source"],
        y_label="Entities Extracted",
        x_label="NER Model",
    ),
    # ── NER quality charts (NER datasets with gold labels) ────────
    ChartSpec(
        name="ner_entity_f1_by_model",
        title="Entity F1 by NER Model",
        sources=["kg-extract_*.jsonl"],
        filters={"source_type": "ner_dataset"},
        x_field="model_slug",
        y_field="entity_f1",
        group_fields=["source_id"],
        variant_fields=[],
        repeat_fields=["model_slug", "data_source"],
        y_label="Entity Micro F1",
        x_label="NER Model",
    ),
    ChartSpec(
        name="ner_precision_recall",
        title="NER Precision vs Recall by Model",
        sources=["kg-extract_*.jsonl"],
        filters={"source_type": "ner_dataset"},
        x_field="entity_precision",
        y_field="entity_recall",
        group_fields=["source_id"],
        variant_fields=[],
        repeat_fields=["model_slug", "data_source"],
        y_label="Entity Recall",
        x_label="Entity Precision",
    ),
    ChartSpec(
        name="ner_speed_vs_f1",
        title="NER Speed vs Quality (Pareto Frontier)",
        sources=["kg-extract_*.jsonl"],
        filters={"source_type": "ner_dataset"},
        x_field="avg_ms_per_chunk",
        y_field="entity_f1",
        group_fields=["model_slug"],
        variant_fields=[],
        repeat_fields=["model_slug", "data_source"],
        y_label="Entity Micro F1",
        x_label="Avg ms/chunk",
    ),
    # ── RE quality charts ─────────────────────────────────────────
    ChartSpec(
        name="re_triple_f1_by_model",
        title="Triple F1 by RE Model",
        sources=["kg-re_*.jsonl"],
        filters={},
        x_field="model_slug",
        y_field="triple_f1",
        group_fields=["dataset"],
        variant_fields=[],
        repeat_fields=["model_slug", "dataset"],
        y_label="Triple F1",
        x_label="Model",
    ),
    ChartSpec(
        name="re_speed_vs_f1",
        title="RE Speed vs Quality",
        sources=["kg-re_*.jsonl"],
        filters={},
        x_field="avg_ms_per_text",
        y_field="triple_f1",
        group_fields=["model_slug"],
        variant_fields=[],
        repeat_fields=["model_slug", "dataset"],
        y_label="Triple F1",
        x_label="Avg ms/text",
    ),
    # ── ER charts (unchanged) ─────────────────────────────────────
    ChartSpec(
        name="er_pairwise_f1",
        title="Entity Resolution Pairwise F1 by Dataset",
        sources=["kg-resolve_*.jsonl"],
        filters={},
        x_field="dataset",
        y_field="pairwise_f1",
        group_fields=["dataset"],
        variant_fields=[],
        repeat_fields=["dataset"],
        y_label="Pairwise F1",
    ),
    # ── GraphRAG charts (unchanged) ───────────────────────────────
    ChartSpec(
        name="graphrag_retrieval_quality",
        title="GraphRAG Passage Recall by Entry+Expansion",
        sources=["kg-graphrag_*.jsonl"],
        filters={},
        x_field="expansion",
        y_field="passage_recall",
        group_fields=["entry_method"],
        variant_fields=["expansion"],
        repeat_fields=["entry_method", "expansion", "book_id"],
        y_label="Passage Recall",
        x_label="Graph Expansion",
    ),
]
